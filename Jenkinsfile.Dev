pipeline {
  environment {
    sregistry = "https://registry.hub.docker.com/eran101/morse-server"
    cregistry = "https://registry.hub.docker.com/eran101/morse-client"
    registryCredential = 'dockerhub_id'
    dockerImage = 'latest'
  }
  agent any
    stages {
        stage('Git clone server code') {
            steps {
                git url: 'https://github.com/eran101/morse-server.git', 
                branch: 'main'
            }
        }
        stage('Build server image') {
          steps {
            script {
              simage = docker.build("eran101/morse-server", "-f DockerfileS .")
            }
          }
        }
       stage('Push server image') {
         steps {
           script {
       docker.withRegistry("${sregistry}", "${registryCredential}") {
       simage.push("${env.BUILD_NUMBER}")            
       simage.push("latest")        
              }    
           }
        }
    }

        stage('Git clone client code') {
            steps {
                git url: 'https://github.com/eran101/morse-client.git', 
                branch: 'main'
            }
        }
        stage('Build client image') {
          steps {
            script {
              simage = docker.build("eran101/morse-client", "-f DockerfileC .")
            }
          }
        }
       stage('Push client image') {
         steps {
           script {
       docker.withRegistry("${cregistry}", "${registryCredential}") {
       simage.push("${env.BUILD_NUMBER}")            
       simage.push("latest")        
              }    
           }
        }
    }

}
}